<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Omega </title>
</head>

<body>

    <div id="root"></div>

    <script src="omega2.js"></script>

    <script>
        var httpFetch = {
            $type: 'div',
            _items: [],
            _onAdd: function (text) {
                this._items.push({title: text});
            },
            $init: function () {
                var options = {
                    method: "get",
                    credentials: "same-origin",
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                };

                // fetch('https://jsonplaceholder.typicode.com/posts', options)
                //     .then(r => { return r.json(); })
                //     .then(posts => { this._items = posts; })
            },
            $getComponents: function () {
                var items = this._items;
                var onAdd = this._onAdd.bind(this);

                var list = {
                    $type: 'ul',
                    $getComponents: function () {
                        return items.map(function (item, index) {
                            return {
                                $type: 'My-Li',
                                _title: item.title
                            }
                        })
                    }
                }

                var input = {
                    $type: 'input',
                    className: 'foobar',
                    style: 'margin: 5px; width: 100%;',
                    type: 'text',
                    onkeyup: function (e) {
                        if (e.keyCode !== 13)
                            return;
                        onAdd(e.target.value);
                        this.value = '';
                    }
                }

                return [
                    input,
                    list
                ]
            }
        };

        var node = {
            $type: 'div',
            $getComponents: function() {
                return [
                    {
                        $type: 'span',
                        style: 'color: blue;',
                        $text: 'Hello World:'
                    },
                    {
                        $type: 'input',
                        type: 'text',
                        placeholder: 'Type Here and press enter',
                        onkeyup: function(e) {
                            if (e.keyCode !== 13)
                            return;
                            console.log(e.target.value);
                        }
                    }
                ]
            }
        }

        var myLi = {
            $type: 'li',
            _title: '',
            _updateStyle: function (style) {
                this.style = style;
            },
            $getComponents: function () {
                var updateStyle = this._updateStyle;
                return [
                    this._title,
                    {
                        $type: 'button',
                        type: 'button',
                        $text: 'style',
                        onclick: function () {
                            updateStyle('color: blue;');
                        }
                    }
                ]
            }
        };

        var root = document.getElementById('root');
        // Omega(root, node);
        Omega(root, httpFetch, {
            'My-Li': myLi
        });
    </script>
</body>

</html>